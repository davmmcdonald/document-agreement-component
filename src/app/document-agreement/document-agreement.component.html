<div class="container">
  <h1>Legal Document Review</h1>
  <p class="instructions">
    Please review each document and check the box to indicate your agreement. 
    You must agree to all documents before continuing.
  </p>

  <form [formGroup]="agreementForm" aria-describedby="form-instructions">
    @if (loading()) {
      <div class="loading" role="status" aria-live="polite"></div>
    }

    @for (group of groupedDocuments(); track group.type) {
      <div class="document" aria-labelledby="{{ group.type }}-heading">
        <div class="details">
          <div>
            <h2 id="{{ group.type }}-heading">
              {{ replaceUnderscores(group.type) | titlecase }}
              <span class="version">(v{{ group.default.version }})</span>
            </h2>
            @if (group.default.changesOnly) {
              <div class="tag">Changes-Only</div>
            }
          </div>

          <div class="button-wrapper">
            @if (group.default.changesOnly) {
              <a [href]="getFullDocument(group)" 
                 class="button" 
                 target="_blank" 
                 rel="noopener noreferrer"
                 aria-label="View full document for {{ replaceUnderscores(group.type) | titlecase }}">
                View Full Document
              </a>
            }
            <button type="button" 
                    class="button" 
                    (click)="toggleFullscreen(group)" 
                    aria-pressed="{{ group.fullscreen }}"
                    [attr.aria-label]="group.fullscreen ? 'Exit fullscreen' : 'Enter fullscreen'">
              <i class="fa-solid fa-expand" aria-hidden="true"></i>
            </button>
          </div>
        </div>

        <div class="wrapper" [class.fullscreen]="group.fullscreen">
          @if (group.fullscreen) {
            <div class="toolbar">
              <button type="button" 
                      class="minimize" 
                      (click)="toggleFullscreen(group)"
                      aria-label="Close fullscreen view">
                <i class="fa-solid fa-xmark" aria-hidden="true"></i>
              </button>
            </div>
          }
          <iframe [src]="group.default.safeUrl" 
                  title="PDF viewer for {{ replaceUnderscores(group.type) | titlecase }}" 
                  frameborder="0">
          </iframe>
        </div>

        <div class="agreement">
          <input type="checkbox" 
                 class="checkbox" 
                 [formControlName]="group.type" 
                 id="{{ group.type }}-checkbox">
          <label for="{{ group.type }}-checkbox">
            I agree to the complete {{ replaceUnderscores(group.type) | titlecase }}
          </label>
        </div>
      </div>
    }

    <button type="submit" class="button primary" (click)="submitForm($event)">
      Submit
    </button>
  </form>

  <div class="alert" 
       [class.visible]="alert().visible" 
       [class.error]="alert().isError" 
       role="alert" 
       aria-live="assertive">
    {{ alert().message }}
  </div>
</div>